import React, { useState, useEffect } from 'react';
import { useData } from '../contexts/DataContext';
import { Match } from '../types';
import CategoryNavigation from '../components/CategoryNavigation';
import MatchList from '../components/MatchList';
import Player from '../components/Player';
import './Home.css';

const Home: React.FC = () => {
    const {
        categories,
        liveMatches,
        upcomingMatches,
        selectedCategory,
        setSelectedCategory,
        filteredMatches
    } = useData();

    const [selectedMatch, setSelectedMatch] = useState<Match | null>(null);

    const handleMatchClick = (match: Match) => {
        setSelectedMatch(match);
    };

    const closePlayer = () => {
        setSelectedMatch(null);
    };

    return (
        <div className="home-page">
            <CategoryNavigation
                categories={categories}
                selectedCategory={selectedCategory}
                onCategoryChange={setSelectedCategory}
            />

            <main className="home-content">
                {/* –í–∏–¥–µ–æ–ø–ª–µ–µ—Ä */}
                {selectedMatch && (
                    <div className="player-section">
                        <div className="player-header">
                            <h2>üé¨ {selectedMatch.player1} vs {selectedMatch.player2}</h2>
                            <button className="close-player" onClick={closePlayer}>‚úï</button>
                        </div>
                        <Player
                            primarySrc={selectedMatch.streamUrl || ''}
                            fallbackSrc={selectedMatch.fallbackUrl}
                            className="main-player"
                            previewImage={selectedMatch.previewImage}
                            matchTitle={`${selectedMatch.player1} vs ${selectedMatch.player2}`}
                            isLive={selectedMatch.isLive && selectedMatch.status === 'live'}
                        />
                        <div className="match-info">
                            <span className="tournament">ÔøΩ {selectedMatch.tournament}</span>
                            <span className="live-badge">LIVE</span>
                        </div>
                    </div>
                )}

                {/* –ü—Ä—è–º—ã–µ —Ç—Ä–∞–Ω—Å–ª—è—Ü–∏–∏ */}
                <MatchList
                    matches={liveMatches}
                    title="üé• –ü–†–Ø–ú–´–ï –¢–†–ê–ù–°–õ–Ø–¶–ò–ò"
                    onMatchClick={handleMatchClick}
                />

                {/* –ú–∞—Ç—á–∏ –∏ —Ç—É—Ä–Ω–∏—Ä—ã */}
                <MatchList
                    matches={upcomingMatches}
                    title="ÔøΩÔ∏è –†–ê–°–ü–ò–°–ê–ù–ò–ï –ú–ê–¢–ß–ï–ô"
                    onMatchClick={handleMatchClick}
                />
            </main>
        </div>
    );
};

export default Home;
